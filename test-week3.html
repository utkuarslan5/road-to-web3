<!DOCTYPE html>
<html>
<head>
    <title>Week 3 Test</title>
</head>
<body>
    <h1>Testing Week 3 Contract</h1>
    <div id="output"></div>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.umd.min.js"></script>
    <script>
        const rpcUrl = 'https://polygon-amoy.g.alchemy.com/v2/TkrgpEOpu3jxDokxXlWBg';
        const contractAddress = '0xa19CE93621c003747b58ab98FaD7b419A6C596d4';
        
        const abi = [
            "function statsOf(uint256 tokenId) external view returns (tuple(uint48 lastAction, uint16 level, uint16 power, uint16 agility, uint16 vitality, uint32 victories, uint32 defeats, uint8 rarity))",
            "function tokenURI(uint256 tokenId) external view returns (string)",
        ];
        
        async function test() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Connecting to Polygon Amoy...</p>';
            
            try {
                const provider = new ethers.JsonRpcProvider(rpcUrl);
                const contract = new ethers.Contract(contractAddress, abi, provider);
                
                output.innerHTML += '<p>✓ Connected to contract</p>';
                
                // Get Token #1
                const tokenURI = await contract.tokenURI(1);
                output.innerHTML += '<p>✓ Token #1 exists!</p>';
                output.innerHTML += '<p>TokenURI length: ' + tokenURI.length + ' chars</p>';
                
                // Parse the data URI
                if (tokenURI.startsWith('data:application/json;base64,')) {
                    const json = JSON.parse(atob(tokenURI.split(',')[1]));
                    output.innerHTML += '<h2>' + json.name + '</h2>';
                    output.innerHTML += '<p>' + json.description + '</p>';
                    
                    if (json.image) {
                        output.innerHTML += '<img src="' + json.image + '" style="max-width: 400px; border: 2px solid #333;" />';
                    }
                }
                
                // Get stats
                const stats = await contract.statsOf(1);
                const rarityLabels = ["Common", "Uncommon", "Rare", "Epic", "Mythic"];
                
                output.innerHTML += '<h3>Stats:</h3>';
                output.innerHTML += '<ul>';
                output.innerHTML += '<li>Level: ' + stats.level + '</li>';
                output.innerHTML += '<li>Power: ' + stats.power + '</li>';
                output.innerHTML += '<li>Agility: ' + stats.agility + '</li>';
                output.innerHTML += '<li>Vitality: ' + stats.vitality + '</li>';
                output.innerHTML += '<li>Rarity: ' + rarityLabels[stats.rarity] + '</li>';
                output.innerHTML += '<li>W/L: ' + stats.victories + '/' + stats.defeats + '</li>';
                output.innerHTML += '</ul>';
                
            } catch (error) {
                output.innerHTML += '<p style="color: red;">✗ Error: ' + error.message + '</p>';
                console.error(error);
            }
        }
        
        test();
    </script>
</body>
</html>
